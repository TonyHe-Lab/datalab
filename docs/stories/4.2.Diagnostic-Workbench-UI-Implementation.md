---
title: "Story 4.2: Diagnostic Workbench UI Implementation"
epic: 4
story: 2
status: Draft
---

## Story

**As a** maintenance engineer,
**I want** a diagnostic workbench interface,
**so that** I can enter fault descriptions and get AI-generated diagnostic suggestions with reference cases.

## Acceptance Criteria

AC-1: Split view layout
- Validation steps: Implement 60/40 split view layout as specified
- Pass condition: Layout responds correctly to window resizing

AC-2: Fault description input
- Validation steps: Create text area for fault description with diagnose button
- Pass condition: User can enter text and trigger diagnosis

AC-3: Diagnosis result display
- Validation steps: Display AI-generated diagnosis with summary and resolution steps
- Pass condition: Results are formatted with ReactMarkdown and tags

AC-4: Reference cases panel
- Validation steps: Show list of similar historical cases with details
- Pass condition: Cases display ID, date, snippet, and have view details button

AC-5: API integration
- Validation steps: Connect UI to backend chat and search APIs
- Pass condition: Real data flows from backend to frontend

## Tasks / Subtasks

- [ ] Task 1: Implement split view layout (AC: 1)
  - [ ] Create WorkbenchPage component with 60/40 split
  - [ ] Use Ant Design Grid or Flexbox for responsive layout
  - [ ] Add proper styling and spacing
  - [ ] Test layout at different screen sizes

- [ ] Task 2: Create fault input section (AC: 2)
  - [ ] Implement TextArea for fault description
  - [ ] Add "Diagnose" button with loading state
  - [ ] Create input validation and error handling
  - [ ] Add character count and formatting helpers

- [ ] Task 3: Implement diagnosis result display (AC: 3)
  - [ ] Create DiagnosisResult component
  - [ ] Integrate ReactMarkdown for formatted output
  - [ ] Add tags for fault code and component
  - [ ] Implement collapsible sections for resolution steps

- [ ] Task 4: Create reference cases panel (AC: 4)
  - [ ] Implement ReferenceCases component with Ant Design List
  - [ ] Create case item layout with ID, date, snippet
  - [ ] Add "View Details" button with modal
  - [ ] Implement modal with full case details

- [ ] Task 5: API service integration (AC: 5)
  - [ ] Create chat service for /api/chat endpoint
  - [ ] Create search service for /api/search endpoint
  - [ ] Implement React Query for data fetching
  - [ ] Add error handling and loading states

- [ ] Task 6: State management and UX (AC: 1,2,3,4,5)
  - [ ] Implement form state management
  - [ ] Add loading skeletons for async operations
  - [ ] Create error boundary and user feedback
  - [ ] Implement optimistic updates where applicable

## Dev Notes

### Previous Story Insights
- Story 4.1: React app setup with Ant Design and routing [Source: docs/stories/4.1.React-App-Setup-Ant-Design.md]
- Story 3.3: RAG chat endpoint implementation [Source: docs/stories/3.3.RAG-Chat-Endpoint-Implementation.md]
- Story 3.2: Hybrid search for reference cases [Source: docs/stories/3.2.Hybrid-Search-Implementation.md]

### Data Models
From frontend specification:
- Chat request: { query: string } [Source: docs/frontend-spe.md#6-api-集成层-service-layer]
- Chat response: AI-generated diagnosis with summary and resolution steps [Source: docs/UX Master Prompt.md#Core-Pages-to-Implement]
- Search response: List of reference cases with metadata [Source: docs/UX Master Prompt.md#Core-Pages-to-Implement]
- Case details: Full work order JSON with structured data [Source: docs/UX Master Prompt.md#Core-Pages-to-Implement]

### API Specifications
From frontend specification:
- POST /api/chat - Submit fault description, get diagnosis [Source: docs/frontend-spe.md#6-api-集成层-service-layer]
- GET /api/search - Search for similar cases [Source: docs/stories/3.2.Hybrid-Search-Implementation.md]
- React Query for managing server state [Source: docs/frontend-spe.md#4-状态管理与数据流-state-management]
- Axios for HTTP requests with error handling [Source: docs/frontend-spe.md#6-api-集成层-service-layer]

### File Locations
Based on project structure:
- `frontend/src/pages/WorkbenchPage.tsx` - Main workbench page component
- `frontend/src/components/DiagnosisInput.tsx` - Fault description input
- `frontend/src/components/DiagnosisResult.tsx` - Diagnosis result display
- `frontend/src/components/ReferenceCases.tsx` - Reference cases panel
- `frontend/src/components/CaseDetailsModal.tsx` - Case details modal
- `frontend/src/services/chatService.ts` - Chat API service
- `frontend/src/services/searchService.ts` - Search API service
- `frontend/src/types/diagnosis.ts` - TypeScript types for diagnosis data

### Testing Requirements
From architecture.md testing strategy:
- Unit tests for UI components
- Integration tests for API services
- UI interaction tests with testing-library
- Accessibility tests for form inputs
- Responsive design testing

### Technical Constraints
- Split view layout: Left 60%, Right 40% [Source: docs/UX Master Prompt.md#Core-Pages-to-Implement]
- Ant Design components for consistency [Source: docs/UX Master Prompt.md#Technical-Constraints]
- ReactMarkdown for formatted text rendering [Source: docs/UX Master Prompt.md#Core-Pages-to-Implement]
- Modal for detailed case view [Source: docs/UX Master Prompt.md#Core-Pages-to-Implement]
- Loading skeletons for async operations [Source: docs/frontend-spe.md#7-异常处理-error-handling]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-28 | 1.0 | Initial story creation | Scrum Master |
